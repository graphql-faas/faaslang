<!DOCTYPE html>
<!-- Built with spec-md -->
<html><head><meta charset="utf-8"><title>FaaSlang</title><style>body {
  color: #333333;
  font: 13pt/18pt Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  margin: 6rem auto 3rem;
  max-width: 780px;
}


/* Links */

a {
  color: #3B5998;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}


/* Section headers */

h1, h2, h3, h4, h5, h6, h7, h8 {
  margin: 3rem 0 1em;
  position: relative;
}

h1 {
  font-size: 1.5em;
  margin: 8rem 0 2em;
}

h2 {
  font-size: 1.45em;
  margin: 8rem 0 1em;
}

h3 {
  font-size: 1.30em;
  margin: 5rem 0 1em;
}

h4 {
  font-size: 1.20em;
}

h5 {
  font-size: 1.12em;
}

h6, h7, h8 {
  font-size: 1.1em;
}

section .spec-secid {
  margin-right: 1ex;
  position: absolute;
  right: 100%;
  text-align: right;
  white-space: nowrap;
}

footer {
  font-size: 75%;
  opacity: 0.5;
  text-align: center;
  margin-top: 12rem;
}


/* Table of contents */

.spec-toc {
  margin: 1rem 0 3rem;
}

.spec-toc .title {
  content: 'Contents';
  display: block;
  font-weight: bold;
  margin: 3rem 0 1rem;
}

.spec-toc .spec-secid {
  margin-right: 1ex;
}

.spec-toc ol {
  list-style: none;
  padding-left: 0;
}

.spec-toc ol ol {
  list-style: none;
  padding-left: 2ex;
}

.spec-toc li {
  position: relative;
  padding: 5px 0 0 30px;
  margin: -5px 0 0 -30px;
}

.spec-toc a {
  color: #333333;
}

.spec-toc a:hover {
  text-decoration: none;
}

.spec-toc a .spec-secid {
  color: #3B5998;
}

.spec-toc a:hover .spec-secid {
  text-decoration: underline;
}

.spec-toc .toggle {
  display: none;
}

.spec-toc .toggle + label {
  cursor: pointer;
  left: 10px;
  opacity: 1;
  padding: 3px 5px 3px 6px;
  position: absolute;
  top: 8px;
  transform: rotate(0deg);
  transition: all 0.18s ease-in-out;
}

.spec-toc .toggle + label:after {
  border-color: transparent transparent transparent #bbc;
  border-style: solid;
  border-width: 6px 0 6px 7px;
  content: ' ';
  display: block;
  height: 0;
  width: 0;
}

.spec-toc .toggle:checked + label {
  transform: rotate(90deg);
}

.spec-toc li:not(:hover) > .toggle:checked + label {
  opacity: 0;
}

.spec-toc .toggle:not(:checked) ~ ol {
  max-height: 0;
  overflow: hidden;
}


/* Sidebar */

.spec-sidebar-toggle {
  display: none;
}

.spec-sidebar-toggle + label {
  position: fixed;
  right: 0;
  top: 0;
  padding: 10px 15px;
  font-size: 30px;
  color: rgba(0,0,0,0.7);
  z-index: 2;
  cursor: pointer;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

.spec-sidebar {
  display: none;
  position: fixed;
  right: 0;
  top: 0;
  width: 320px;
  font-size: 80%;
  overflow-y: scroll;
  height: 100%;
  padding: 0 0 5rem 30px;
  box-sizing: border-box;
  background: #f0f0f0;
}

.spec-sidebar-toggle:checked ~ .spec-sidebar {
  display: block;
  box-shadow:
    -1px 0 rgba(0,0,0,0.12),
    -4px 0 8px -2px rgba(0,0,0,0.05);
}

.spec-sidebar .viewing > a:after {
  color: #8b9;
  content: '\2022';
  margin-left: 1ex;
}

@media (min-width: 1240px) {
  .spec-sidebar-toggle + label {
    display: none;
  }

  .spec-sidebar {
    display: block;
    box-shadow:
      inset 1px 0 rgba(0,0,0,0.05),
      inset 4px 0 8px -2px rgba(0,0,0,0.08) !important;
  }

  body {
    padding-right: 300px;
  }
}


/* Notes */

.spec-note {
  background: #FEFEF3;
  border-left: solid 4px #F4E925;
  margin: 1em -1em;
  min-width: 416px;
  padding: 1ex 1em 1ex calc(1em - 4px);
  width: -moz-fit-content;
  width: -webkit-fit-content;
  width: fit-content;
}

.spec-note::before {
  color: #6C6613;
  content: 'Note';
  display: block;
  font: italic 11pt/18pt Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  opacity: 0.6;
  user-select: none;
}


/* Todos */

.spec-todo {
  color: #666666;
  margin: 1em 0 1em 5em;
  min-height: 1em;
}

.spec-todo::before {
  content: 'todo';
  display: block;
  float: left;
  margin-left: -5em;
  text-transform: uppercase;
}

/* Index table */

.spec-index ol {
  list-style-type: none;
  margin: 0 0 0 2rem;
  padding: 0;
  column-width: 210px;
  column-gap: 2rem;
}

.spec-index ol li {
  width: min-content;
}

/* Code */

code {
  background: #FAFAFA;
  font-family: Consolas, Monaco, monospace;
  font-size: 85%;
  font-weight: inherit;
  margin: -2px -1px;
  padding: 3px 3px;
  white-space: pre;
}

pre code {
  background: none;
  font-weight: inherit;
  margin: 0;
  padding: 0;
}

pre {
  background: #FAFAFA;
  border-left: solid 4px #E9E9E9;
  margin: 1em -1em;
  min-width: 40ch;
  padding: 1ex 1em 1ex calc(1em - 4px);
  width: -moz-fit-content;
  width: -webkit-fit-content;
  width: fit-content;
}

.spec-example {
  background: #FAFAFF;
  border-left: solid 4px #BBBBFF;
}

.spec-counter-example {
  background: #FFFAFA;
  border-left: solid 4px #FFBBBB;
}

.spec-example > a,
.spec-counter-example > a {
  display: block;
  font: italic 11pt/18pt Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  opacity: 0.6;
  user-select: none;
}

.spec-counter-example > a {
  color: #98593b;
}


/* Tables */

table {
  border-collapse: collapse;
}

th {
  background-color: #F9F9F9;
}

td, th {
  border: 1px solid #D0D0D0;
  padding: 0.4em;
  vertical-align: baseline;
}


/* Edits */

ins {
  background-color: rgba(0, 200, 30, 0.08);
  text-decoration: none;
}

del {
  background-color: rgba(200, 0, 0, 0.08);
}

.spec-added, .spec-removed {
  border-left: 4px solid;
  margin-left: -18px;
  padding-left: 14px;
}

.spec-added {
  border-color: #396;
}

.spec-removed {
  border-color: #933;
  text-decoration: line-through;
}


/* Values */

.spec-keyword {
  font-weight: bold;
}

.spec-string {
  font-family: Consolas, Monaco, monospace;
  white-space: pre;
}

var {
  font-style: italic;
}

*[data-name] {
  transition: 0.15s background ease-out;
  border-radius: 2px;
  padding: 0 3px;
  margin: 0 -3px;
}


/* Grammar semantics, algorithms and calls */

.spec-semantic,
.spec-algo {
  margin: 1rem 0 1rem 2rem;
}

.spec-semantic > .spec-rhs {
  display: inline-block;
  margin-left: 1ex;
}

.spec-semantic > .spec-nt::after,
.spec-algo > .spec-call:first-child::after {
  content: ':';
  font-style: normal;
  font-weight: bold;
  margin-left: 1ex;
}

.spec-semantic ol, .spec-semantic ol ol ol ol,
.spec-algo ol, .spec-algo ol ol ol ol {
  list-style-type: decimal;
}

.spec-semantic ol ol, .spec-semantic ol ol ol ol ol,
.spec-algo ol ol, .spec-algo ol ol ol ol ol {
  list-style-type: lower-alpha;
}

.spec-semantic ol ol ol, .spec-semantic ol ol ol ol ol ol,
.spec-algo ol ol ol, .spec-algo ol ol ol ol ol ol {
  list-style-type: lower-roman;
}

.spec-call > a {
  color: inherit;
}


/* Grammar productions */

.spec-production {
  margin: 1rem 0 1rem 2rem;
}

.spec-production > .spec-nt::after {
  content: ':';
  font-style: normal;
  font-weight: bold;
  margin: 0 1ex;
}

.spec-semantic.d2 > .spec-nt::after,
.spec-production.d2 > .spec-nt::after {
  content: '::';
}

.spec-semantic.d3 > .spec-nt::after,
.spec-production.d3 > .spec-nt::after {
  content: ':::';
}

.spec-rhs {
  margin-left: 2rem;
}

.spec-oneof {
  display: inline;
}

.spec-oneof::before {
  content: 'one of';
  font-style: normal;
  font-weight: bold;
}

.spec-oneof > table {
  margin-left: 2rem;
}

.spec-oneof .spec-rhs {
  border: none;
  margin: 0;
  padding: 0 0.5em;
  vertical-align: baseline;
}

.spec-rhs .spec-constrained:not(:first-child),
.spec-rhs .spec-quantified:not(:first-child),
.spec-rhs .spec-nt:not(:first-child),
.spec-rhs .spec-t:not(:first-child),
.spec-rhs .spec-rx:not(:first-child),
.spec-rhs .spec-prose:not(:first-child),
.spec-rhs .spec-empty:not(:first-child),
.spec-rhs .spec-lookahead:not(:first-child) {
  margin-left: 1ex;
}

.spec-condition {
  font-size: 85%;
}

.spec-condition::before {
  content: '[+'
}

.spec-condition.not::before {
  content: '[~'
}

.spec-condition::after {
  content: ']'
}

.spec-empty,
.spec-prose {
  color: #666666;
}

.spec-nt {
  font-style: italic;
}

.spec-nt > a {
  color: inherit;
}

.spec-quantifiers,
.spec-params {
  font-size: 65%;
  font-style: normal;
  vertical-align: sub;
}

.spec-quantifier.list {
  color: #3348D3;
}

.spec-quantifier.optional {
  color: #83238E;
}

.spec-params,
.spec-condition {
  color: #1C7758;
}

.spec-params::before {
  content: '[';
}

.spec-params::after {
  content: ']';
}

.spec-quantifier:not(:last-child)::after,
.spec-param:not(:last-child)::after {
  color: #666666;
  content: ', ';
}

.spec-param.conditional::before {
  content: '?';
}

.spec-t, .spec-rx {
  color: #333333;
  font-family: monospace;
  font-weight: bold;
}

.spec-butnot::before {
  color: #666666;
  content: 'but not';
  font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  font-weight: normal;
  margin-right: 1ex;
}

.spec-butnot > *:not(:first-child)::before {
  color: #666666;
  content: 'or';
  font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  font-weight: normal;
  margin-right: 1ex;
}

.spec-rhs .spec-oneof::before,
.spec-rhs .spec-butnot::before {
  margin-left: 1ex;
}

.spec-lookahead > * {
  margin: 0 !important;
}

.spec-lookahead > *:not(:first-child)::before {
  color: #666666;
  content: ', ';
  font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  font-style: normal;
  font-weight: normal;
}

.spec-lookahead::before {
  color: #666666;
  content: '[lookahead = ';
  font-family: Cambria, "Palatino Linotype", Palatino, "Liberation Serif", serif;
  font-style: normal;
  font-weight: normal;
}

.spec-lookahead.not::before {
  content: '[lookahead \2260  ';
}

.spec-lookahead.set::before {
  content: '[lookahead \2208  {';
  margin-right: 0;
}

.spec-lookahead.set.not::before {
  content: '[lookahead \2209  {';
}

.spec-lookahead::after {
  color: #666666;
  content: ']';
}

.spec-lookahead.set::after {
  content: '}]';
}
</style><style>/* Copied from node_modules/prismjs/themes/prism.css */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style><script>(function (){
var styleSheet = document.getElementsByTagName('style')[0].sheet;
var ruleIndex;

function removeHighlight() {
  if (ruleIndex) {
    styleSheet.deleteRule(ruleIndex);
    ruleIndex = void 0;
  }
}

function highlightKeyword(name) {
  removeHighlight();
  ruleIndex = styleSheet.insertRule(
    '*[data-name="' + name + '"] { background: #FBF8D0; }',
    styleSheet.cssRules.length
  );
}

document.documentElement.addEventListener('mouseover', function (event) {
  var nameAttribute = event.target.attributes['data-name'];
  if (nameAttribute) {
    highlightKeyword(nameAttribute.value);
  }
});

document.documentElement.addEventListener('mouseout', removeHighlight);
})()</script></head><body><header><h1>FaaSlang</h1><nav class="spec-toc"><div class="title">Contents</div><ol><li><a href="#sec-FaaSlang"><span class="spec-secid">1</span>FaaSlang</a><input hidden class="toggle" type="checkbox" checked id="_toggle_1" /><label for="_toggle_1"></label><ol><li><a href="#sec-FaaSlang.-"><span class="spec-secid">1.1</span>功能即服务语言</a></li></ol></li><li><a href="#sec-undefined.-"><span class="spec-secid">2</span>目录</a></li><li><a href="#sec-undefined.-FaaSlang-"><span class="spec-secid">3</span>什么是FaaSlang?</a></li><li><a href="#sec-undefined.-FaaSlang-"><span class="spec-secid">4</span>为什么选择FaaSlang?</a></li><li><a href="#sec-undefined.-"><span class="spec-secid">5</span>规范</a><input hidden class="toggle" type="checkbox" checked id="_toggle_5" /><label for="_toggle_5"></label><ol><li><a href="#sec-undefined.-.FaaSlang-"><span class="spec-secid">5.1</span>FaaSlang 资源定义</a></li><li><a href="#sec-undefined.-.-"><span class="spec-secid">5.2</span>上下文定义</a></li><li><a href="#sec-undefined.-.-"><span class="spec-secid">5.3</span>参数</a><input hidden class="toggle" type="checkbox" checked id="_toggle_5.3" /><label for="_toggle_5.3"></label><ol><li><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.1</span>约束</a></li><li><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.2</span>类型</a></li><li><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.3</span>类型转换</a></li><li><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.4</span>可空值</a></li><li><a href="#sec--HTTP-"><span class="spec-secid">5.3.5</span>设置HTTP头</a></li></ol></li><li><a href="#sec-undefined.-.FaaSlang-"><span class="spec-secid">5.4</span>FaaSlang 资源请求</a><input hidden class="toggle" type="checkbox" checked id="_toggle_5.4" /><label for="_toggle_5.4"></label><ol><li><a href="#sec-Context"><span class="spec-secid">5.4.1</span>Context</a></li><li><a href="#sec-Errors"><span class="spec-secid">5.4.2</span>Errors</a><input hidden class="toggle" type="checkbox" checked id="_toggle_5.4.2" /><label for="_toggle_5.4.2"></label><ol><li><a href="#sec-ClientError"><span class="spec-secid">5.4.2.1</span>ClientError</a></li><li><a href="#sec-ParameterError"><span class="spec-secid">5.4.2.2</span>ParameterError</a><input hidden class="toggle" type="checkbox" checked id="_toggle_5.4.2.2" /><label for="_toggle_5.4.2.2"></label><ol><li><a href="#sec-Details-Required"><span class="spec-secid">5.4.2.2.1</span>Details: Required</a></li><li><a href="#sec-Details-Invalid"><span class="spec-secid">5.4.2.2.2</span>Details: Invalid</a></li></ol></li><li><a href="#sec-FatalError"><span class="spec-secid">5.4.2.3</span>FatalError</a></li><li><a href="#sec-RuntimeError"><span class="spec-secid">5.4.2.4</span>RuntimeError</a></li><li><a href="#sec-ValueError"><span class="spec-secid">5.4.2.5</span>ValueError</a></li></ol></li></ol></li></ol></li><li><a href="#sec-FaaSlang-Server-and-Gateway-Implementation"><span class="spec-secid">6</span>FaaSlang Server and Gateway: Implementation</a></li><li><a href="#sec-Acknowledgements"><span class="spec-secid">7</span>Acknowledgements</a></li></ol></nav></header><section id="sec-FaaSlang" secid="1"><h2><span class="spec-secid" title="link to this section"><a href="#sec-FaaSlang">1</a></span>FaaSlang</h2><p><img src="https://raw.githubusercontent.com/graphql-faas/faaslang/gh-pages/images/faaslang-logo-small.png" alt="FaaSlang Logo"/></p><section id="sec-FaaSlang.-" secid="1.1"><h3><span class="spec-secid" title="link to this section"><a href="#sec-FaaSlang.-">1.1</a></span>功能即服务语言</h3><p><strong>0.3.x</strong>, dated <strong>February 12th, 2018</strong>. 以下是最新的FaaSlang规范的工作草案，版本<strong>0.3.x</strong>，日期为<strong>2018年2月12日</strong>。</p><p>FaaSlang是一个简单的开放规范，旨在定义围绕FaaS（&ldquo;无服务器&rdquo;）函数，网关和客户端接口（来自任何语言/ SDK的请求）的语义和实现细节。它的设计目标是通过鼓励我们如何记录和与它们交互的简单约定来降低FaaS微服务的组织复杂性，包括类型安全机制。同样，GraphQL旨在为开发人员与嵌套关系（图形）数据的接口方式提供意见和规范，FaaSlang也为FaaS资源做同样的事情。</p><p>如果您使用符合FaaSlang的部署和API网关（例如，如https://stdlib.com所使用的那样），您将获得与无服务器功能的传统网关相比的以下优势：</p><ul><li>标准呼叫约定（HTTP）</li><li>类型安全</li><li>强制文档</li><li>后台执行（立即返回响应，以工作方式运行逻辑）</li></ul><p>而这仅仅是个开始。您正在寻找的所有好东西，如速率限制，身份验证等，都不是FaaSlang规范的一部分，但可以轻松添加到此存储库中提供的示例中。</p></section></section><section id="sec-undefined.-" secid="2"><h2><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-">2</a></span>目录</h2><ol><li><a href="#introduction">介绍</a></li><li><a href="#why-faaslang">为何选择FaaSlang？</a></li><li><a href="#specification">规范</a><ol><li><a href="#faaslang-resource-definition">FaaSlang资源定义</a></li><li><a href="#context-definition">上下文定义</a></li><li><a href="#parameters">参数</a><ol><li><a href="#constraints">约束</a></li><li><a href="#types">类型</a></li><li><a href="#type-conversion">类型转换</a></li><li><a href="#nullability">空值</a></li></ol></li><li><a href="#faaslang-resource-requests">FaaSlang 资源请求</a><ol><li><a href="#context">上下文</a></li><li><a href="#errors">错误</a><ol><li><a href="#clienterror">客户端错误</a></li><li><a href="#parametererror">参数错误</a><ol><li><a href="#details-required">细节: 必填</a></li><li><a href="#details-invalid">细节: 必填</a></li></ol></li><li><a href="#fatalerror">致命错误</a></li><li><a href="#runtimeerror">运行时错误</a></li><li><a href="#valueerror">ValueError</a></li></ol></li></ol></li></ol></li><li><a href="#faaslang-server-and-gateway-implementation">FaaSlang 服务器和网关: 实现</a></li><li><a href="#acknowledgements">致谢</a></li></ol></section><section id="sec-undefined.-FaaSlang-" secid="3"><h2><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-FaaSlang-">3</a></span>什么是FaaSlang?</h2><p>简而言之，FaaSlang定义了&ldquo;无服务器&rdquo;功能部署和执行（API）网关的语义和规则，将以下的东西：</p><pre><code><span class="token comment" spellcheck="true">// hello_world.js</span>

<span class="token comment" spellcheck="true">/**
* My hello world function!
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'world'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>转换为一个无限可扩展的Web API（使用&ldquo;无服务器&rdquo;提供程序），可以像这样通过HTTP调用（GET）：</p><pre><code>https://myhost.com/username/servicename/hello_world?name=joe
</code></pre><p>或者像这样（POST）：</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"joe"</span>
<span class="token punctuation">}</span>
</code></pre><p>并给出这样的结果：</p><pre><code><span class="token string">"hello joe"</span>
</code></pre><p>或者，当发生类型不匹配时（如<code>{&quot;name&quot;:10}</code>）：</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ParameterError"</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></section><section id="sec-undefined.-FaaSlang-" secid="4"><h2><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-FaaSlang-">4</a></span>为什么选择FaaSlang?</h2><p>&ldquo;无服务器&rdquo;领域正在快速增长，随着它的发展，跟上所需的工具链也是如此。每个基础架构提供商都有自己的标准和围绕FaaS做事的方式，以至于我们依赖于各个开发人员来挑选最佳的部署框架。</p><p>FaaSlang采用不同的方法，并提供API网关的规范（以及相当强大的，非供应商特定的Node.js实现），作为&ldquo;锁定&rdquo;您和您的团队成员部署方式的一种方式执行&ldquo;无服务器&rdquo;功能。</p><p>一个AWS Lambda函数的示例 <strong>（A）</strong> ;</p><pre><code>exports<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> myVar <span class="token operator">=</span> event<span class="token punctuation">.</span>myVar<span class="token punctuation">;</span>
  <span class="token keyword">let</span> requiredVar <span class="token operator">=</span> event<span class="token punctuation">.</span>requiredVar<span class="token punctuation">;</span>
  myVar <span class="token operator">=</span> myVar <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> myVar<span class="token punctuation">;</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello from Lambda!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>或Microsoft Azure功能 <strong>(B)</strong>;</p><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> myVar <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>myVar <span class="token operator">||</span> req<span class="token punctuation">.</span>body <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>myVar<span class="token punctuation">;</span>
  <span class="token keyword">let</span> requiredVar <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>requiredVar <span class="token operator">||</span> req<span class="token punctuation">.</span>body <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>requiredVar<span class="token punctuation">;</span>
  myVar <span class="token operator">=</span> myVar <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> myVar<span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>res <span class="token operator">=</span> <span class="token punctuation">{</span>body<span class="token punctuation">:</span> <span class="token string">'Hello from Microsoft Azure!'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>FaaSlang定义了Node.js函数的模型;</p><pre><code><span class="token comment" spellcheck="true">/**
* @param {Number} myVar A number
* @param {String} requiredVar must be a string!
* @returns {String}
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>myVar <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> requiredVar<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello from FaaSlang-compliant service vendor.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>注释用作类型安全的语义定义的一部分（如果它们不能从默认值中推断出来），则可以专门定义期望的参数，并且您仍然有一个可选context对象，以实现更强大的执行（参数重载等）。 ）</p><p>以下是当前FaaS工作流程的样子：</p><p><img src="https://raw.githubusercontent.com/graphql-faas/faaslang/gh-pages/images/current-faas-workflow.jpg" alt="Current FaaS Workflow"/></p><p>这是启用FaaSlang的工作流程的样子。</p><p><img src="https://raw.githubusercontent.com/graphql-faas/faaslang/gh-pages/images/faaslang-workflow.jpg" alt="FaaSlang Workflow"/></p><p>FaaSlang是数以千计的FaaS部署的成果，覆盖成千上万的开发人员分布在众多云服务提供商，并且需要标准化我们组织和与这些功能通信的能力。</p></section><section id="sec-undefined.-" secid="5"><h2><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-">5</a></span>规范</h2><section id="sec-undefined.-.FaaSlang-" secid="5.1"><h3><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.FaaSlang-">5.1</a></span>FaaSlang 资源定义</h3><p>FaaSlang定义是一个<code>definition.json</code>遵守以下格式的文件</p><p>定这样的函数（文件名<code>my_function.js</code>）：</p><pre><code><span class="token comment" spellcheck="true">/**
* This is my function, it likes the greek alphabet
* @param {String} alpha Some letters, I guess
* @param {Number} beta And a number
* @param {Boolean} gamma True or false?
* @returns {Object} some value
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> my_function <span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> gamma<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">/* your code */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>你需要提供如下所示的函数定义：</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my_function"</span><span class="token punctuation">,</span>
  <span class="token property">"format"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"nodejs"</span><span class="token punctuation">,</span>
    <span class="token property">"async"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"This is my function, it likes the greek alphabet"</span><span class="token punctuation">,</span>
  <span class="token property">"bg"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"info"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"charge"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"context"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>
  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"alpha"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Some letters, I guess"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"beta"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
      <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"And a number"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"gamma"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"True or false?"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"returns"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"some value"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>此定义是可扩展的，这意味着您可以向其添加其他字段，但必须遵守此模式。</p><p>定义必须实现以下字段;</p><table><thead><tr><th>字段 </th><th>说明 </th></tr></thead><tbody><tr><td>name </td><td>A user&#8208;readable function name (used to execute the function), must match <code>/[A-Z][A-Z0-9_]*/i</code> </td></tr><tr><td>format </td><td>An object requiring a <code>language</code> field, along with any implementation details </td></tr><tr><td>description </td><td>A brief description of what the function does, can be empty (<code>&quot;&quot;</code>) </td></tr><tr><td>bg </td><td>An object containing &ldquo;mode&rdquo; and &ldquo;value&rdquo; parameters specifying the behavior of function responses when executed in the background </td></tr><tr><td>charge </td><td>An integer between 0 and 100 defining the cost (arbitrary units) to run this function, charged to authenticated users </td></tr><tr><td>params </td><td>An array of <code>NamedParameter</code>s, representing function arguments</td></tr><tr><td>returns </td><td>A <code>Parameter</code> without a <code>defaultValue</code> representing function return value </td></tr></tbody></table></section><section id="sec-undefined.-.-" secid="5.2"><h3><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-">5.2</a></span>上下文定义</h3><p>如果函数不访问执行上下文详细信息，则应始终为null。如果它是一个对象，则表示该函数确实访问了上下文详细信息（即<code>remoteAddress</code>,http标头等 &ndash; 请参阅上下文）。</p><p>此对象不必为空，它可以包含特定于的详细信息; 例如，<code>&quot;context&quot;: {&quot;user&quot;: [&quot;id&quot;, &quot;email&quot;]}</code>可以指示执行上下文专门访问经过身份验证的用户ID和电子邮件地址。</p></section><section id="sec-undefined.-.-" secid="5.3"><h3><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-">5.3</a></span>参数</h3><p>参数具有以下格式;</p><table><thead><tr><th>字段 </th><th>必须 </th><th>说明 </th></tr></thead><tbody><tr><td>name </td><td>NamedParameter Only </td><td>The name of the Parameter, must match <code>/[A-Z][A-Z0-9_]*/i</code> </td></tr><tr><td>type </td><td>yes </td><td>A string representing a valid FaaSlang type </td></tr><tr><td>description </td><td>yes </td><td>A short description of the parameter, can be empty string (<code>&quot;&quot;</code>) </td></tr><tr><td>defaultValue </td><td>no </td><td>Must match the specified type, <strong>if not provided this parameter is required</strong> </td></tr></tbody></table><section id="sec-undefined.-.-.-" secid="5.3.1"><h4><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-.-">5.3.1</a></span>约束</h4><p>第一个参数永远不能是&ldquo;对象&rdquo;类型。这是为了确保所有语言实现中的通用调用（即支持参数重载）的请求一致性。</p></section><section id="sec-undefined.-.-.-" secid="5.3.2"><h4><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-.-">5.3.2</a></span>类型</h4><p>由于FaaSlang旨在为多语言，因此使用它定义的函数必须具有强类型签名。并非所有类型都保证在每种语言中都以相同的方式使用，我们将继续定义每种语言应如何与FaaSlang类型接口的规范。目前，类型是JSON值的有限超集。</p><table><thead><tr><th>类型 </th><th>说明 </th><th>参考输入 (JSON) </th></tr></thead><tbody><tr><td>boolean </td><td>True or False </td><td><code>true</code> or <code>false</code> </td></tr><tr><td>string </td><td>Basic text or character strings </td><td><code>&quot;hello&quot;</code>, <code>&quot;GOODBYE!&quot;</code> </td></tr><tr><td>number </td><td>Any double&#8208;precision <a href="https://en.wikipedia.org/wiki/IEEE_floating_point">Floating Point</a> value </td><td><code>2e+100</code>, <code>1.02</code>, <code>-5</code> </td></tr><tr><td>float </td><td>Alias for <code>number</code> </td><td><code>2e+100</code>, <code>1.02</code>, <code>-5</code> </td></tr><tr><td>integer </td><td>Subset of <code>number</code>, integers between <code>-2^53 + 1</code> and <code>+2^53 - 1</code> (inclusive) </td><td><code>0</code>, <code>-5</code>, <code>2000</code> </td></tr><tr><td>object </td><td>Any JSON&#8208;serializable Object </td><td><code>{}</code>, <code>{&quot;a&quot;:true}</code>, <code>{&quot;hello&quot;:[&quot;world&quot;]}</code> </td></tr><tr><td>object.http </td><td>An object representing an HTTP Response. Accepts <code>headers</code>, <code>body</code> and <code>statusCode</code> keys </td><td><code>{&quot;body&quot;: &quot;Hello World&quot;}</code>, <code>{&quot;statusCode&quot;: 404, &quot;body&quot;: &quot;not found&quot;}</code>, <code>{&quot;headers&quot;: {&quot;Content-Type&quot;: &quot;image/png&quot;}, &quot;body&quot;: new Buffer(...)}</code> </td></tr><tr><td>array </td><td>Any JSON&#8208;serializable Array </td><td><code>[]</code>, <code>[1, 2, 3]</code>, <code>[{&quot;a&quot;:true}, null, 5]</code> </td></tr><tr><td>buffer </td><td>Raw binary octet (byte) data representing a file </td><td><code>{&quot;_bytes&quot;: [8, 255]}</code> or <code>{&quot;_base64&quot;: &quot;d2h5IGRpZCB5b3UgcGFyc2UgdGhpcz8/&quot;}</code> </td></tr><tr><td>any </td><td>Any value mentioned above </td><td><code>5</code>, <code>&quot;hello&quot;</code>, <code>[]</code> </td></tr></tbody></table></section><section id="sec-undefined.-.-.-" secid="5.3.3"><h4><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-.-">5.3.3</a></span>类型转换</h4><p><code>buffer</code>类型将自动转换为object类似<code> {&quot;_bytes&quot;: []}</code>或匹配的单个键值对的任何类型<code>{&quot;_base64&quot;: &quot;&quot;}</code>。</p><p>否则，提供给函数的参数应与其定义的类型匹配。通过查询参数通过HTTP发出的请求POST请求包含类型<code>application/x-www-form-urlencoded</code>将在可能的情况下自动从字符串转换为各自的预期类型(参考如下 <a href="#faaslang-resource-requests">FaaSlang Resource Requests</a>)</p><table><thead><tr><th>类型 </th><th>转换规则 </th></tr></thead><tbody><tr><td>boolean </td><td><code>&quot;t&quot;</code> and <code>&quot;true&quot;</code> become <code>true</code>, <code>&quot;f&quot;</code> and <code>&quot;false&quot;</code> become <code>false</code>, otherwise <strong>do not convert</strong> </td></tr><tr><td>string </td><td>No conversion </td></tr><tr><td>number </td><td>Determine float value, if NaN <strong>do not convert</strong>, otherwise convert </td></tr><tr><td>float </td><td>Determine float value, if NaN <strong>do not convert</strong>, otherwise convert </td></tr><tr><td>integer </td><td>Determine float value, if NaN <strong>do not convert</strong>, may fail integer type check if not in range </td></tr><tr><td>object </td><td>Parse as JSON, if invalid <strong>do not convert</strong>, object may fail type check (array, buffer) </td></tr><tr><td>object.http </td><td>Parse as JSON, if invalid <strong>do not convert</strong>, object may fail type check (array, buffer) </td></tr><tr><td>array </td><td>Parse as JSON, if invalid <strong>do not convert</strong>, object may fail type check (object, buffer) </td></tr><tr><td>buffer </td><td>Parse as JSON, if invalid <strong>do not convert</strong>, object may fail type check (object, array) </td></tr><tr><td>any </td><td>No conversion </td></tr></tbody></table></section><section id="sec-undefined.-.-.-" secid="5.3.4"><h4><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.-.-">5.3.4</a></span>可空值</h4><p>所有类型都可以为空，但只能通过<code>&quot;defaultValue&quot;: null</code>在<code>NamedParameter</code>定义中设置来指定可空性。也就是说，如果提供了默认值，则该类型不再可以为空。</p></section><section id="sec--HTTP-" secid="5.3.5"><h4><span class="spec-secid" title="link to this section"><a href="#sec--HTTP-">5.3.5</a></span>设置HTTP头</h4><p>FaaSlang规范并非仅用于HTTP，但如果通过HTTP使用提供的回调方法，则传递给回调的<code>第三个参数应该是表示HTTP Header键值对的Object</code>。</p><p>例如，要返回类型为<code>image/png</code>... 的图像</p><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>imageName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// fetch image, returns a buffer</span>
  <span class="token keyword">let</span> png <span class="token operator">=</span> imageName <span class="token operator">===</span> <span class="token string">'cat'</span> <span class="token operator">?</span>
    fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/images/kitty.png`</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
    fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/images/no-image.png`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Forces image/png over HTTP requests, default</span>
  <span class="token comment" spellcheck="true">//  for buffer would otherwise be application/octet-stream</span>
  <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> png<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'image/png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>只有在回调结束函数时才能使用第三个参数，即不能与异步函数一起使用。这可用于通过HTTP，设置缓存详细信息（E&#8208;Tag标头）等提供任何类型的内容。</p></section></section><section id="sec-undefined.-.FaaSlang-" secid="5.4"><h3><span class="spec-secid" title="link to this section"><a href="#sec-undefined.-.FaaSlang-">5.4</a></span>FaaSlang 资源请求</h3><p>符合FaaSlang标准的请求<code>必须</code>完成以下步骤;</p><ol><li>确保资源定义在存储或加入时有效且符合要求。</li><li>使用初始请求详细信息执行握手（即HTTP）</li><li>接受Array，Object或url编码变量的字符串</li><li>如果存在HTTP和查询参数，则查询参数用作URL编码变量</li><li>如果存在HTTP POST和查询参数，拒绝请求尝试时指定POST的请求同时包含一个<code> ClientError</code></li><li>If over HTTP POST, requests <strong>must</strong> include a <code>Content-Type</code> header or a <code>ClientError</code> is immediately returned</li><li>If over HTTP POST, <code>Content-Type</code> <strong>must</strong> be <code>application/json</code> for <code>Array</code> or <code>Object</code> data, or <code>application/x-www-form-urlencoded</code> for string data or a <code>ClientError</code> is immediately returned</li><li>If <code>application/x-www-form-urlencoded</code> values are provided (either via POST body or query parameters), convert types based on <a href="#type-conversion">Type Conversion</a> and knowledge of the function definition and create an <code>Object</code></li><li>If <code>Array</code>: Parameters will be checked for type consistency in the order of the definition <code>params</code></li><li>If <code>Object</code>: Parameters will be checked for type consistency based on names of the definition <code>params</code></li><li>If any inconsistencies are found, cease execution and immediately return a <code>ParameterError</code></li><li>If a parameter has no defaultValue specified and is not provided, immediately return a <code>ParameterError</code></li><li>Try to execute the function, if the function fails to parse or is not valid, immediately return a <code>FatalError</code></li><li>If a function hits a specified timeout (execution time limit), immediately return a <code>FatalError</code></li><li>If a function returns an error (via callback) or one is thrown and not caught, immediately return a <code>RuntimeError</code></li><li>If function returns inconsistent response (does not match <code>returns</code> type), immediately return a <code>ValueError</code></li><li>If no errors are encountered, return the value to the client</li><li>If over HTTP and <code>content-type</code> is not being overloaded (i.e. developer specified through a vendor&#8208;specific mechanism), return <code>buffer</code> type data as <code>application/octet-stream</code> and any other values as <code>application/json</code>.</li></ol><p>接受Array，Object或url编码变量的字符串 如果存在HTTP和查询参数，则查询参数用作URL编码变量 如果存在HTTP POST和查询参数，请拒绝尝试使用a指定POST主体的请求 ClientError 如果通过HTTP POST，请求必须包含Content&#8208;Type标头或ClientError立即返回 如果通过HTTP POST，Content&#8208;Type 必须是application/jsonfor Array或Objectdata，或者application/x&#8208;www&#8208;form&#8208;urlencoded对于字符串数据或a ClientError立即返回 如果application/x&#8208;www&#8208;form&#8208;urlencoded提供了值（通过POST正文或查询参数），则根据类型转换和函数定义知识转换类型并创建Object 如果Array：将按定义的顺序检查参数的类型一致性params 如果Object：将根据定义的名称检查参数的类型一致性params 如果发现任何不一致，请停止执行并立即返回 ParameterError 如果参数未指定defaultValue且未提供，请立即返回a ParameterError 尝试执行该函数，如果函数无法解析或无效，请立即返回a FatalError 如果函数达到指定的超时（执行时间限制），则立即返回a FatalError 如果函数返回错误（通过回调）或者抛出一个并且未捕获，则立即返回a RuntimeError 如果函数返回不一致的响应（与returns类型不匹配），则立即返回aValueError 如果未遇到任何错误，请将值返回给客户端 如果通过HTTP并且content&#8208;type没有过载（即通过特定于供应商的机制指定开发人员），则返回buffer类型数据application/octet&#8208;stream和任何其他值application/json。</p><section id="sec-Context" secid="5.4.1"><h4><span class="spec-secid" title="link to this section"><a href="#sec-Context">5.4.1</a></span>Context</h4><p>Every function intended to be consumed via FaaSlang has the option to specify an <em>optional</em> magic <code>context</code> parameter that receives vendor&#8208;specific information about the function execution context &ndash; for example, if consumed over HTTP, header details. FaaSlang definitions must specify whether or not they consume a <code>context</code> object. Context objects are extensible but <strong>MUST</strong> contain the following fields;</p><table><thead><tr><th>Field </th><th>Definition </th></tr></thead><tbody><tr><td>params </td><td>An <code>object</code> mapping called parameter names to their values </td></tr><tr><td>http </td><td><code>null</code> if not accessed via http, otherwise an <code>object</code> </td></tr><tr><td>http.headers </td><td>If accessed via HTTP, an <code>object</code> containing header values </td></tr></tbody></table></section><section id="sec-Errors" secid="5.4.2"><h4><span class="spec-secid" title="link to this section"><a href="#sec-Errors">5.4.2</a></span>Errors</h4><p>Errors returned by FaaSlang&#8208;compliant services must follow the following JSON format:</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ClientError"</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"You know nothing, Jon Snow"</span><span class="token punctuation">,</span>
    <span class="token property">"details"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><code>details</code> is an optional object that can provide additional Parameter details. Valid Error types are:</p><ul><li><code>ClientError</code></li><li><code>ParameterError</code></li><li><code>FatalError</code></li><li><code>RuntimeError</code></li><li><code>ValueError</code></li></ul><section id="sec-ClientError" secid="5.4.2.1"><h5><span class="spec-secid" title="link to this section"><a href="#sec-ClientError">5.4.2.1</a></span>ClientError</h5><p><code>ClientError</code>s are returned as a result of bad or malformed client data, including lack of authorization or a missing function (not found). If over HTTP, they <strong>must</strong> returns status codes in the range of <code>4xx</code>.</p></section><section id="sec-ParameterError" secid="5.4.2.2"><h5><span class="spec-secid" title="link to this section"><a href="#sec-ParameterError">5.4.2.2</a></span>ParameterError</h5><p><code>ParameterError</code>s are a result of Parameters not passing type&#8208;safety checks, and <strong>must</strong> return status code <code>400</code> if over HTTP.</p><p>Parameter Errors <strong>must</strong> have the following format;</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ParameterError"</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"ParameterError"</span><span class="token punctuation">,</span>
    <span class="token property">"details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>...<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><code>&quot;details&quot;</code> should be an object mapping parameter names to their respective validation (type&#8208;checking) errors. Currently, this specification defines two classifications of a ParameterError for a parameter; <em>required</em> and <em>invalid</em>. The format of <code>&quot;details&quot;: {}</code> should follow this format;</p><section id="sec-Details-Required" secid="5.4.2.2.1"><h6><span class="spec-secid" title="link to this section"><a href="#sec-Details-Required">5.4.2.2.1</a></span>Details: Required</h6><pre><code><span class="token punctuation">{</span>
  <span class="token property">"param_name"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"((descriptive message stating parameter is required))"</span><span class="token punctuation">,</span>
    <span class="token property">"required"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></section><section id="sec-Details-Invalid" secid="5.4.2.2.2"><h6><span class="spec-secid" title="link to this section"><a href="#sec-Details-Invalid">5.4.2.2.2</a></span>Details: Invalid</h6><pre><code><span class="token punctuation">{</span>
  <span class="token property">"param_name"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"((descriptive message stating parameter is invalid))"</span><span class="token punctuation">,</span>
    <span class="token property">"invalid"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"expected"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"actual"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"hello world"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></section></section><section id="sec-FatalError" secid="5.4.2.3"><h5><span class="spec-secid" title="link to this section"><a href="#sec-FatalError">5.4.2.3</a></span>FatalError</h5><p><code>FatalError</code>s are a result of function mismanagement &ndash; either your function could not be loaded, executed, or it timed out. These <strong>must</strong> return status code <code>500</code> if over HTTP.</p></section><section id="sec-RuntimeError" secid="5.4.2.4"><h5><span class="spec-secid" title="link to this section"><a href="#sec-RuntimeError">5.4.2.4</a></span>RuntimeError</h5><p><code>RuntimeError</code>s are a result of uncaught exceptions in your code as it runs, including errors you explicitly choose to throw (or send to clients via a callback, for example). These <strong>must</strong> return status code <code>403</code> if over HTTP.</p></section><section id="sec-ValueError" secid="5.4.2.5"><h5><span class="spec-secid" title="link to this section"><a href="#sec-ValueError">5.4.2.5</a></span>ValueError</h5><p><code>ValueError</code>s are a result of your function returning an unexpected value based on FaaSlang type&#8208;safety mechanisms. These <strong>must</strong> return status code <code>502</code> if over HTTP.</p><p><code>ValueError</code> looks like an <em>invalid</em> ParameterError, where the <code>details</code> Object only ever contains a single key called <code>&quot;returns&quot;</code>. These are encountered due to implementation issues on the part of the function developer.</p><pre><code><span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ValueError"</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"ValueError"</span><span class="token punctuation">,</span>
    <span class="token property">"details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"returns"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"((descriptive message stating return value is invalid))"</span><span class="token punctuation">,</span>
        <span class="token property">"invalid"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"expected"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"boolean"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"actual"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2017</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></section></section></section></section><section id="sec-FaaSlang-Server-and-Gateway-Implementation" secid="6"><h2><span class="spec-secid" title="link to this section"><a href="#sec-FaaSlang-Server-and-Gateway-Implementation">6</a></span>FaaSlang Server and Gateway: Implementation</h2><p>A fully&#8208;compliant FaaSlang gateway (that just uses local function resources) is available with this package, simply clone it and run <code>npm test</code> or look at the <code>/tests</code> folder for more information.</p><p>The current FaaSlang specification is used in production by the FaaS provider <a href="https://stdlib.com">StdLib</a>, and is available for local use with the <a href="https://github.com/stdlib/lib">StdLib CLI Package</a> which relies on this repository as a dependency.</p></section><section id="sec-Acknowledgements" secid="7"><h2><span class="spec-secid" title="link to this section"><a href="#sec-Acknowledgements">7</a></span>Acknowledgements</h2><p>The software contained within this repository has been developed and is copyrighted by the <a href="https://stdlib.com">StdLib</a> Team at Polybit Inc. and is MIT licensed. The specification itself is not intended to be owned by a specific corporate entity, and has been developed in conjunction with other developers and organizations. </p></section><footer>Written in <a href="http://leebyron.com/spec-md/" target="_blank">Spec Markdown</a>.</footer><input hidden class="spec-sidebar-toggle" type="checkbox" id="spec-sidebar-toggle" aria-hidden /><label for="spec-sidebar-toggle" aria-hidden>&#x2630;</label><div class="spec-sidebar" aria-hidden><div class="spec-toc"><div class="title"><a href="#">FaaSlang</a></div><ol><li id="_sidebar_1"><a href="#sec-FaaSlang"><span class="spec-secid">1</span>FaaSlang</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_1" /><label for="_sidebar_toggle_1"></label><ol><li id="_sidebar_1.1"><a href="#sec-FaaSlang.-"><span class="spec-secid">1.1</span>功能即服务语言</a></li></ol></li><li id="_sidebar_2"><a href="#sec-undefined.-"><span class="spec-secid">2</span>目录</a></li><li id="_sidebar_3"><a href="#sec-undefined.-FaaSlang-"><span class="spec-secid">3</span>什么是FaaSlang?</a></li><li id="_sidebar_4"><a href="#sec-undefined.-FaaSlang-"><span class="spec-secid">4</span>为什么选择FaaSlang?</a></li><li id="_sidebar_5"><a href="#sec-undefined.-"><span class="spec-secid">5</span>规范</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_5" /><label for="_sidebar_toggle_5"></label><ol><li id="_sidebar_5.1"><a href="#sec-undefined.-.FaaSlang-"><span class="spec-secid">5.1</span>FaaSlang 资源定义</a></li><li id="_sidebar_5.2"><a href="#sec-undefined.-.-"><span class="spec-secid">5.2</span>上下文定义</a></li><li id="_sidebar_5.3"><a href="#sec-undefined.-.-"><span class="spec-secid">5.3</span>参数</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_5.3" /><label for="_sidebar_toggle_5.3"></label><ol><li id="_sidebar_5.3.1"><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.1</span>约束</a></li><li id="_sidebar_5.3.2"><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.2</span>类型</a></li><li id="_sidebar_5.3.3"><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.3</span>类型转换</a></li><li id="_sidebar_5.3.4"><a href="#sec-undefined.-.-.-"><span class="spec-secid">5.3.4</span>可空值</a></li><li id="_sidebar_5.3.5"><a href="#sec--HTTP-"><span class="spec-secid">5.3.5</span>设置HTTP头</a></li></ol></li><li id="_sidebar_5.4"><a href="#sec-undefined.-.FaaSlang-"><span class="spec-secid">5.4</span>FaaSlang 资源请求</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_5.4" /><label for="_sidebar_toggle_5.4"></label><ol><li id="_sidebar_5.4.1"><a href="#sec-Context"><span class="spec-secid">5.4.1</span>Context</a></li><li id="_sidebar_5.4.2"><a href="#sec-Errors"><span class="spec-secid">5.4.2</span>Errors</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_5.4.2" /><label for="_sidebar_toggle_5.4.2"></label><ol><li id="_sidebar_5.4.2.1"><a href="#sec-ClientError"><span class="spec-secid">5.4.2.1</span>ClientError</a></li><li id="_sidebar_5.4.2.2"><a href="#sec-ParameterError"><span class="spec-secid">5.4.2.2</span>ParameterError</a><input hidden class="toggle" type="checkbox" id="_sidebar_toggle_5.4.2.2" /><label for="_sidebar_toggle_5.4.2.2"></label><ol><li id="_sidebar_5.4.2.2.1"><a href="#sec-Details-Required"><span class="spec-secid">5.4.2.2.1</span>Details: Required</a></li><li id="_sidebar_5.4.2.2.2"><a href="#sec-Details-Invalid"><span class="spec-secid">5.4.2.2.2</span>Details: Invalid</a></li></ol></li><li id="_sidebar_5.4.2.3"><a href="#sec-FatalError"><span class="spec-secid">5.4.2.3</span>FatalError</a></li><li id="_sidebar_5.4.2.4"><a href="#sec-RuntimeError"><span class="spec-secid">5.4.2.4</span>RuntimeError</a></li><li id="_sidebar_5.4.2.5"><a href="#sec-ValueError"><span class="spec-secid">5.4.2.5</span>ValueError</a></li></ol></li></ol></li></ol></li><li id="_sidebar_6"><a href="#sec-FaaSlang-Server-and-Gateway-Implementation"><span class="spec-secid">6</span>FaaSlang Server and Gateway: Implementation</a></li><li id="_sidebar_7"><a href="#sec-Acknowledgements"><span class="spec-secid">7</span>Acknowledgements</a></li></ol></div><script>(function (){
var currentSection;
var numberedSections = [];

var sections = document.getElementsByTagName('section');
for (var i = 0; i < sections.length; i++) {
  if (sections[i].getAttribute('secid')) {
    numberedSections.push(sections[i]);
  }
}

var scrollPos = window.scrollY;
var pending = false;
window.addEventListener('scroll', function (e) {
  scrollPos = window.scrollY;
  if (!pending) {
    pending = true;
    window.requestAnimationFrame(function () {
      updateSectionFocus(scrollPos);
      pending = false;
    });
  }
});

function updateSectionFocus(pos) {
  var readLine = pos + document.documentElement.clientHeight / 4;

  var focusedSection;
  for (var n = numberedSections.length - 1; n >= 0; n--) {
    if (numberedSections[n].offsetTop < readLine) {
      focusedSection = numberedSections[n];
      break;
    }
  }

  var secid = focusedSection && focusedSection.getAttribute('secid');
  if (secid !== currentSection) {
    currentSection && fold(currentSection, false);
    secid && fold(secid, true);
    currentSection = secid;
  }
}

function fold(secid, check) {
  document.getElementById('_sidebar_' + secid).className = check ? 'viewing' : '';
  var sections = secid.split('.');
  while (sections.length) {
    var toggle = document.getElementById('_sidebar_toggle_' + sections.join('.'));
    if (toggle) {
      toggle.checked = check;
    }
    sections.pop();
  }
}

updateSectionFocus(window.scrollY);
})()</script></div></body></html>
